<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room :)</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="css/roomStyle.css">
    <script>
        const ROOM_ID = "<%= roomId %>"
        const USER_ID = "<%= user.id %>"
        console.log("Host => <%= host.emails[0].value %>");
        console.log("User => <%= user.emails[0].value %>");
        
    </script>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js" defer></script>
    <script src="/socket.io/socket.io.js" defer></script>
    <script src="js/script.js" defer></script>

</head>
<body>
    <div class="wrapper">
        
        <main>
            <div id="video-grid">
            </div>
        </main>
        <div class="sidebar">
            <nav class="nav">
                <li class="nav-item">
                    <a class="nav-link active" href="#">Item 1</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Item 2</a>
                </li>
            </nav>
            <div class="container">
                <ul id="messages"></ul>
            </div>
            <form action="">
                <div class="row">
                    <div class="col-sm-10">
                        <input class="form-control" id="m" autocomplete="off" />
                    </div>
                    <button class="col-sm-2 btn btn-info"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>
                </div>
            </form>
        </div>
    </div>
    <div class="call-controls d-flex justify-content-around align-items-center">
        <% if (user.id == host.id) { %>
        <button type="button" class="btn">ask a question</button>
        <% } else { %>
        <button class="btn">RAise hand</button>
        <% } %>
        <div class="btn-group" role="group" aria-label="Button group">
        <button type="button" id="audio-btn" class="btn btn-danger">Audio</button>
        <a href="/home"><button type="button" class="btn btn-danger">Hang Up</button></a>
        <button type="button" id="video-btn" class="btn btn-danger">Video</button>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        
        const form = document.querySelector("form");
        const input = document.querySelector("#m");
        const messages = document.querySelector("#messages");
        const username = "<%= user.displayName %>";
        const socket = io();

        form.addEventListener("submit", function(event) {
            event.preventDefault();

            addMessage(username + ": " + input.value);

            socket.emit("chat_message", {
                message: input.value
            });

            input.value = "";
            return false;
        }, false);

        socket.on("chat_message", function(data) {
            addMessage(data.username + ": " + data.message);
        });

        socket.on("user_join", function(data) {
            addMessage(data + " just joined the chat!");
        });

        socket.on("user_leave", function(data) {
            addMessage(data + " has left the chat.");
        });

        addMessage("You have joined the chat as '" + username  + "'.");
        socket.emit("user_join", username);

        function addMessage(message) {
            const li = document.createElement("li");
            li.innerHTML = message;
            messages.appendChild(li);
            window.scrollTo(0, document.body.scrollHeight);
        }
    
    </script>
</body>
</html>